# MLflow Tracking Server Configuration
# Chart: community-charts/mlflow
#
# Prerequisites:
#   - PostgreSQL deployed separately (see k8s/postgresql.yaml)
#   - MinIO deployed via Helm (ml-minio)

# Image configuration
image:
  repository: burakince/mlflow
  pullPolicy: IfNotPresent
  tag: ""

# Init container images - use ARM64 compatible images
initImages:
  dbchecker:
    repository: alpine
    pullPolicy: IfNotPresent
    tag: "3.19"
  mlflowDbMigration:
    repository: burakince/mlflow
    pullPolicy: IfNotPresent
    tag: ""
  iniFileInitializer:
    repository: alpine
    pullPolicy: IfNotPresent
    tag: "3.19"

# Service configuration
service:
  enabled: true
  type: ClusterIP
  port: 5000
  containerPort: 5000

# Backend Store - PostgreSQL
backendStore:
  databaseMigration: false
  databaseConnectionCheck: false

  postgres:
    enabled: true
    host: "postgresql"
    port: 5432
    database: "mlflow"
    user: "mlflow"
    password: "mlflow123"
    driver: ""

# Artifact Root - MinIO/S3
artifactRoot:
  proxiedArtifactStorage: false

  s3:
    enabled: true
    bucket: "mlflow-artifacts"
    path: ""
    awsAccessKeyId: "admin"
    awsSecretAccessKey: "admin123"

# Extra environment variables for MinIO endpoint
extraEnvVars:
  MLFLOW_S3_ENDPOINT_URL: "http://ml-minio:9000"
  MLFLOW_S3_IGNORE_TLS: "true"
  AWS_DEFAULT_REGION: "us-east-1"

# Disable built-in PostgreSQL (we deploy separately)
postgresql:
  enabled: false

# Resources
resources:
  requests:
    cpu: 200m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 1Gi

# Pod security context
podSecurityContext:
  fsGroup: 1001

securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  runAsUser: 1001
  runAsGroup: 1001
